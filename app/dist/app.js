"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),PersonListItem=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e));return a.state={path:[]},a}return _inherits(t,e),_createClass(t,[{key:"findExpert",value:function(e,t,a){var s=this,n={person:e._id,subject:t._id};$.ajax({type:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(n),url:"api/shortestPath",dataType:"json",success:function(e){s.setState({path:e})}})}},{key:"render",value:function(){var e=this;return React.createElement("li",{id:this.props.person._id,key:this.props.person._id,className:"collection-item"},React.createElement("span",{className:"title teal-text text-darken-4"},React.createElement("h5",null,React.createElement("strong",null,this.props.person.name))),React.createElement("hr",null),React.createElement("ul",null,React.createElement("li",null,React.createElement("h5",{className:"heading"},"Subjects")),this.props.person.subjects.map(function(e){return React.createElement("li",{key:e._id},e.name)})),React.createElement("ul",null,React.createElement("li",null,React.createElement("h5",{className:"heading"},"Friends")),this.props.person.friends.map(function(e){return React.createElement("li",{key:e._id},e.name)})),React.createElement("h5",{className:"heading"},"Find Expert"),React.createElement("ul",{className:"collection with-header"},this.props.subjects.map(function(t){return React.createElement("li",{className:"collection-item",key:t._id},React.createElement("div",null,t.name,React.createElement("a",{onClick:e.findExpert.bind(e,e.props.person,t),href:"javascript:;",className:"secondary-content"},React.createElement("i",{className:"material-icons right"},"search"))))})),React.createElement("div",{"class":"col s12"},React.createElement("div",{"class":"valign-wrapper"},this.state.path.map(function(e){return React.createElement("a",{key:e._id,href:"#"+e._id,className:"breadcrumb teal-text text-darken-4"},e.name)}))))}}]),t}(React.Component),Person=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){var e=this;return React.createElement("div",null,React.createElement("ul",{className:"collection with-header"},this.props.data.map(function(t){return React.createElement(PersonListItem,{key:t._id,subjects:e.props.subjects,person:t})})))}}]),t}(React.Component),Subject=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",null,React.createElement("ul",{className:"collection with-header"},this.props.subjects.map(function(e){return React.createElement("li",{id:"#"+e._id,key:e._id,className:"collection-item amber-text text-darken-4"},e.name)})))}}]),t}(React.Component),Modal=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,[{key:"render",value:function(){return React.createElement("div",{id:"modal",className:"modal"},React.createElement("div",{className:"modal-content"},React.createElement("h4",null,this.props.title),React.createElement("p",null,this.props.message)),React.createElement("div",{className:"modal-footer"},React.createElement("a",{href:"javascript:;",className:" modal-action modal-close waves-effect waves-green btn"},"Got it!")))}}]),t}(React.Component),App=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return e.state={subjects:[],persons:[],subjectName:"",personName:"",addedUsers:[],addedSubjects:[],error:""},e.handleChange=e.handleChange.bind(e),e.submitPerson=e.submitPerson.bind(e),e.submitSubject=e.submitSubject.bind(e),e}return _inherits(t,e),_createClass(t,[{key:"componentDidMount",value:function(){var e=this;this.serverRequest=$.get("/api/persons",function(t){e.setState({persons:t}),e.serverRequest=$.get("/api/subjects",function(t){e.setState({subjects:t})}.bind(e))}.bind(this))}},{key:"componentWillUnmount",value:function(){this.serverRequest.abort()}},{key:"submitPerson",value:function(e){var t=this;e.preventDefault(),e.stopPropagation();var a={name:this.state.personName,friends:this.state.addedUsers,subjects:this.state.addedSubjects};this.state.personName.length>0?$.ajax({type:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(a),url:"api/person",dataType:"json",success:function(e){var a=t.state.persons;for(var s in t.state.addedUsers)for(var n in a)t.state.persons[n]._id==t.state.addedUsers[s]._id&&a[n].friends.push(e);a.push(e),t.setState({personName:"",persons:a,addedUsers:[],addedSubjects:[],error:""}),Materialize.toast("Added new person "+e.name,4e3),$("#person").val("")},error:function(e){t.setState({error:e.message}),$("#modal").openModal()}}):(this.setState({error:"Please enter a name for the person"}),$("#modal").openModal())}},{key:"submitSubject",value:function(e){var t=this;e.preventDefault(),e.stopPropagation();var a={name:this.state.subjectName};this.state.subjectName.length>0?$.ajax({type:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(a),url:"api/subject",dataType:"json",success:function(e){var a=t.state.subjects;a.push(e),t.setState({subjectName:"",subjects:a}),Materialize.toast("Added new subject "+e.name,4e3),$("#subject").val("")},error:function(e){t.setState({error:e.message}),$("#modal").openModal()}}):(this.setState({error:"Please enter a name for the subject"}),$("#modal").openModal())}},{key:"handleChange",value:function(e){switch(e.target.id){case"subject":this.setState({subjectName:e.target.value.replace(/[^a-z0-9áéíóúñü \.,_-]/gim,"")});break;case"person":this.setState({personName:e.target.value.replace(/[^a-z0-9áéíóúñü \.,_-]/gim,"")})}}},{key:"addItem",value:function(e,t){switch(t.target.id){case"addPerson":if(-1===this.state.addedUsers.indexOf(e)){var a=this.state.addedUsers;a.push(e),this.setState({addedUsers:a})}break;case"addSubject":if(-1===this.state.addedSubjects.indexOf(e)){var a=this.state.addedSubjects;a.push(e),this.setState({addedSubjects:a})}}}},{key:"removeItem",value:function(e,t){switch(t.target.id){case"removePerson":var a=this.state.addedUsers,s=a.indexOf(e);s>-1&&(a.splice(s,1),this.setState({addedUsers:a}));break;case"removeSubject":var a=this.state.addedSubjects,s=a.indexOf(e);s>-1&&(a.splice(s,1),this.setState({addedSubjects:a}))}}},{key:"render",value:function(){var e=this;return React.createElement("div",{className:"container teal-text"},React.createElement("div",{className:"row"},React.createElement("div",{className:"col m6"},React.createElement("h6",{className:"valign-wrapper teal-text text-darken-4"},React.createElement("i",{className:"material-icons pad-right"},"account_circle"),"Persons"),React.createElement(Person,{data:this.state.persons,subjects:this.state.subjects}),React.createElement("div",{className:"row collection-item"},React.createElement("form",{onSubmit:this.submitPerson,className:"input-field col s12 "},React.createElement("input",{onChange:this.handleChange,placeholder:"Add a new Person",id:"person",type:"text","class":"validate"}),React.createElement("label",{"for":"first_name"},"Person Name"),React.createElement("a",{className:"dropdown-button btn margin-bottom",href:"javascript:;","data-activates":"dropdown1"},React.createElement("i",{className:"material-icons left"},"add_circle"),"Add Friends"),React.createElement("ul",{id:"dropdown1",className:"dropdown-content"},this.state.persons.map(function(t){return React.createElement("li",{key:t._id,onClick:e.addItem.bind(e,t)},React.createElement("a",{id:"addPerson",href:"javascript:;"},t.name))})),React.createElement("br",null),React.createElement("div",{className:"margin-bottom"},this.state.addedUsers.map(function(t){return React.createElement("div",{key:t._id,className:"chip padding-right"},t.name,React.createElement("i",{id:"removePerson",onClick:e.removeItem.bind(e,t),className:"material-icons"},"close"))})),React.createElement("a",{className:"dropdown-button btn margin-bottom",href:"#","data-activates":"dropdown2"},React.createElement("i",{className:"material-icons left"},"add_circle"),"Add Subjects"),React.createElement("ul",{id:"dropdown2",className:"dropdown-content"},this.state.subjects.map(function(t){return React.createElement("li",{key:t._id,onClick:e.addItem.bind(e,t)},React.createElement("a",{id:"addSubject",href:"javascript:;"},t.name))})),React.createElement("br",null),React.createElement("div",{className:"margin-bottom"},this.state.addedSubjects.map(function(t){return React.createElement("div",{key:t._id,className:"chip padding-right"},t.name,React.createElement("i",{id:"removeSubject",onClick:e.removeItem.bind(e,t),className:"material-icons"},"close"))})),React.createElement("button",{type:"submit",onClick:this.submitPerson,href:"javascript:;",className:"waves-effect waves-light btn teal "},"Submit")))),React.createElement("div",{className:"col m6"},React.createElement("h6",{className:"valign-wrapper amber-text text-darken-4"},React.createElement("i",{className:"material-icons pad-right"},"cloud_circle"),"Subjects"),React.createElement(Subject,{subjects:this.state.subjects}),React.createElement("div",{className:"collection-item"},React.createElement("form",{onSubmit:this.submitSubject,className:"input-field col s12"},React.createElement("input",{onChange:this.handleChange,placeholder:"Add a new subject",id:"subject",type:"text",className:"validate"}),React.createElement("label",{"for":"first_name"},"Subject Name"),React.createElement("button",{type:"submit",className:"btn waves-effect waves-light amber darken-4",onClick:this.submitSubject},"Submit"))))),React.createElement(Modal,{title:"Error",message:this.state.error}))}}]),t}(React.Component);ReactDOM.render(React.createElement(App,null),document.getElementById("main"));